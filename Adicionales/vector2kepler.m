function [a, e, incli, node, peri, M,n]=vector2kepler(pos,GMS)
% [GM1]= sistema(0);
% GMS=GM1(1,1);
R=sqrt(sum(pos(:,1:3).^2,2));
V=sqrt(sum(pos(:,4:6).^2,2));
a=(2./R-V.^2/GMS).^(-1);
H=cross(pos(:,1:3),pos(:,4:6));
h=sqrt(sum(H.*H,2));
e=sqrt(1-h.^2./(GMS*a));
incli=acosd(H(:,3)./h);
%signos=sign(H(:,3));
node=atan2(H(:,1),-H(:,2));
signos=sign(node);
node=(node+0.5*(1-signos)*2*pi)*180/pi;
sinwf=pos(:,3)./(R.*sind(incli));
coswf=(pos(:,1)./R+sind(node).*sinwf.*cosd(incli))./cosd(node);
wmasf=atan2(real(sinwf),real(coswf));
wmasf=(wmasf+0.5*(1-sign(wmasf))*2*pi)*180/pi;
signos=sign(sum(pos(:,1:3).*pos(:,4:6),2));
Rdot=signos.*sqrt(V.^2-h.^2./R.^2);
sinf=(a.*(1-e.^2).*Rdot)./(h.*e);
cosf=(a.*(1-e.^2)./R-1)./e;
f=atan2(real(sinf),real(cosf));
f=(f+0.5*(1-sign(f))*2*pi).*180/pi;
peri=wmasf-f;
peri=peri+0.5.*(1-sign(peri))*360;
tanE2=((1-e)./(1+e)).^0.5.*tand(f/2);
E=2*atand(tanE2);
M=E-e.*sind(E).*180/pi;
M=M+0.5.*(1-sign(M)).*360;
n=2*pi./a.^(3/2);